{"version":3,"file":"scheme.module.min.js","sources":["../../.config/config.js","../../src/core/api.js","../../src/scheme/script/scheme/scheme-value.js","../../src/scheme/script/scheme/scheme-attribute.js","../../src/scheme/script/scheme/scheme-theme.js","../../src/scheme/script/scheme/scheme-emission.js","../../src/scheme/script/scheme/scheme.js","../../src/scheme/script/scheme/scheme-selector.js","../../src/scheme/index.js","../../src/scheme/main.js"],"sourcesContent":["const config = {\r\n  prefix: 'fr',\r\n  namespace: 'dsfr',\r\n  organisation: '@gouvfr',\r\n  version: '1.5.1'\r\n};\r\n\r\nexport default config;\r\n","import config from './config.js';\nconst api = window[config.namespace];\nexport default api;\n","export const SchemeValue = {\n  SYSTEM: 'system',\n  LIGHT: 'light',\n  DARK: 'dark'\n};\n","import api from '../../api';\n\nexport const SchemeAttribute = {\n  THEME: api.internals.ns.attr('theme'),\n  SCHEME: api.internals.ns.attr('scheme'),\n  TRANSITION: api.internals.ns.attr('transition')\n};\n","export const SchemeTheme = {\n  LIGHT: 'light',\n  DARK: 'dark'\n};\n","import api from '../../api';\n\nexport const SchemeEmission = {\n  SCHEME: api.internals.ns.emission('scheme', 'scheme'),\n  THEME: api.internals.ns.emission('scheme', 'theme'),\n  ASK: api.internals.ns.emission('scheme', 'ask')\n};\n","import api from '../../api.js';\nimport { SchemeValue } from './scheme-value.js';\nimport { SchemeAttribute } from './scheme-attribute.js';\nimport { SchemeTheme } from './scheme-theme.js';\nimport { SchemeEmission } from './scheme-emission.js';\n\nclass Scheme extends api.core.Instance {\n  constructor () {\n    super(false);\n  }\n\n  static get instanceClassName () {\n    return 'Scheme';\n  }\n\n  init () {\n    this.changing = this.change.bind(this);\n\n    if (this.hasAttribute(SchemeAttribute.TRANSITION)) {\n      this.removeAttribute(SchemeAttribute.TRANSITION);\n      this.request(this.restoreTransition.bind(this));\n    }\n\n    const scheme = api.internals.support.supportLocalStorage() ? localStorage.getItem('scheme') : '';\n    const schemeAttr = this.getAttribute(SchemeAttribute.SCHEME);\n\n    switch (scheme) {\n      case SchemeValue.DARK:\n      case SchemeValue.LIGHT:\n      case SchemeValue.SYSTEM:\n        this.scheme = scheme;\n        break;\n\n      default:\n        switch (schemeAttr) {\n          case SchemeValue.DARK:\n            this.scheme = SchemeValue.DARK;\n            break;\n\n          case SchemeValue.LIGHT:\n            this.scheme = SchemeValue.LIGHT;\n            break;\n\n          default:\n            this.scheme = SchemeValue.SYSTEM;\n        }\n    }\n\n    this.addAscent(SchemeEmission.ASK, this.ask.bind(this));\n    this.addAscent(SchemeEmission.SCHEME, this.apply.bind(this));\n  }\n\n  get proxy () {\n    const scope = this;\n\n    const proxyAccessors = {\n      get scheme () {\n        return scope.scheme;\n      },\n      set scheme (value) {\n        scope.scheme = value;\n      }\n    };\n\n    return api.internals.property.completeAssign(super.proxy, proxyAccessors);\n  }\n\n  restoreTransition () {\n    this.setAttribute(SchemeAttribute.TRANSITION, '');\n  }\n\n  ask () {\n    this.descend(SchemeEmission.SCHEME, this.scheme);\n  }\n\n  apply (value) {\n    this.scheme = value;\n  }\n\n  get scheme () {\n    return this._scheme;\n  }\n\n  set scheme (value) {\n    if (this._scheme === value) return;\n    this._scheme = value;\n    switch (value) {\n      case SchemeValue.SYSTEM:\n        this.listenPreferences();\n        break;\n\n      case SchemeValue.DARK:\n        this.unlistenPreferences();\n        this.theme = SchemeTheme.DARK;\n        break;\n\n      case SchemeValue.LIGHT:\n        this.unlistenPreferences();\n        this.theme = SchemeTheme.LIGHT;\n        break;\n\n      default:\n        this.scheme = SchemeValue.SYSTEM;\n        return;\n    }\n\n    this.descend(SchemeEmission.SCHEME, value);\n    if (api.internals.support.supportLocalStorage()) {\n      localStorage.setItem('scheme', value);\n    }\n    this.setAttribute(SchemeAttribute.SCHEME, value);\n  }\n\n  get theme () {\n    return this._theme;\n  }\n\n  set theme (value) {\n    if (this._theme === value) return;\n    switch (value) {\n      case SchemeTheme.LIGHT:\n      case SchemeTheme.DARK:\n        this._theme = value;\n        this.setAttribute(SchemeAttribute.THEME, value);\n        this.descend(SchemeEmission.THEME, value);\n        break;\n    }\n  }\n\n  listenPreferences () {\n    if (this.isListening) return;\n    this.isListening = true;\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    this.mediaQuery.addEventListener('change', this.changing);\n    this.change();\n  }\n\n  unlistenPreferences () {\n    if (!this.isListening) return;\n    this.isListening = false;\n    this.mediaQuery.removeEventListener('change', this.changing);\n    this.mediaQuery = null;\n  }\n\n  change () {\n    if (!this.isListening) return;\n    this.theme = this.mediaQuery.matches ? SchemeTheme.DARK : SchemeTheme.LIGHT;\n  }\n\n  mutate (attributeNames) {\n    if (attributeNames.indexOf(SchemeAttribute.SCHEME) > -1) this.scheme = this.getAttribute(SchemeAttribute.SCHEME);\n    if (attributeNames.indexOf(SchemeAttribute.THEME) > -1) this.theme = this.getAttribute(SchemeAttribute.THEME);\n  }\n\n  dispose () {\n    this.unlistenPreferences();\n  }\n}\n\nexport { Scheme };\n","import api from '../../api.js';\n\nexport const SchemeSelector = {\n  SCHEME: `:root${api.internals.ns.attr.selector('theme')}, :root${api.internals.ns.attr.selector('scheme')}`,\n  SWITCH_THEME: api.internals.ns.selector('switch-theme'),\n  RADIO_BUTTONS: `input[name=\"${api.internals.ns('radios-theme')}\"]`\n};\n","import api from './api.js';\nimport { Scheme } from './script/scheme/scheme.js';\nimport { SchemeValue } from './script/scheme/scheme-value.js';\nimport { SchemeSelector } from './script/scheme/scheme-selector.js';\nimport { SchemeEmission } from './script/scheme/scheme-emission.js';\nimport { SchemeTheme } from './script/scheme/scheme-theme.js';\n\napi.scheme = {\n  Scheme: Scheme,\n  SchemeValue: SchemeValue,\n  SchemeSelector: SchemeSelector,\n  SchemeEmission: SchemeEmission,\n  SchemeTheme: SchemeTheme\n};\n\nexport default api;\n","import api from './index.js';\n\napi.internals.register(api.scheme.SchemeSelector.SCHEME, api.scheme.Scheme);\n\nexport default api;\n"],"names":["api","window","SchemeValue","SYSTEM","LIGHT","DARK","SchemeAttribute","THEME","internals","ns","attr","SCHEME","TRANSITION","SchemeTheme","SchemeEmission","emission","ASK","Scheme","core","Instance","constructor","super","instanceClassName","init","this","changing","change","bind","hasAttribute","removeAttribute","request","restoreTransition","scheme","support","supportLocalStorage","localStorage","getItem","schemeAttr","getAttribute","addAscent","ask","apply","proxy","scope","proxyAccessors","value","property","completeAssign","setAttribute","descend","_scheme","listenPreferences","unlistenPreferences","theme","setItem","_theme","isListening","mediaQuery","matchMedia","addEventListener","removeEventListener","matches","mutate","attributeNames","indexOf","dispose","SchemeSelector","selector","SWITCH_THEME","RADIO_BUTTONS","register"],"mappings":";AAAA,MCCMA,EAAMC,OAAuB,KCDtBC,EAAc,CACzBC,OAAQ,SACRC,MAAO,QACPC,KAAM,QCDKC,EAAkB,CAC7BC,MAAOP,EAAIQ,UAAUC,GAAGC,KAAK,SAC7BC,OAAQX,EAAIQ,UAAUC,GAAGC,KAAK,UAC9BE,WAAYZ,EAAIQ,UAAUC,GAAGC,KAAK,eCLvBG,EAAc,CACzBT,MAAO,QACPC,KAAM,QCAKS,EAAiB,CAC5BH,OAAQX,EAAIQ,UAAUC,GAAGM,SAAS,SAAU,UAC5CR,MAAOP,EAAIQ,UAAUC,GAAGM,SAAS,SAAU,SAC3CC,IAAKhB,EAAIQ,UAAUC,GAAGM,SAAS,SAAU,QCC3C,MAAME,UAAejB,EAAIkB,KAAKC,SAC5BC,cACEC,OAAM,GAGGC,+BACT,MAAO,SAGTC,OACEC,KAAKC,SAAWD,KAAKE,OAAOC,KAAKH,MAE7BA,KAAKI,aAAatB,EAAgBM,cACpCY,KAAKK,gBAAgBvB,EAAgBM,YACrCY,KAAKM,QAAQN,KAAKO,kBAAkBJ,KAAKH,QAG3C,MAAMQ,EAAShC,EAAIQ,UAAUyB,QAAQC,sBAAwBC,aAAaC,QAAQ,UAAY,GACxFC,EAAab,KAAKc,aAAahC,EAAgBK,QAErD,OAAQqB,GACN,KAAK9B,EAAYG,KACjB,KAAKH,EAAYE,MACjB,KAAKF,EAAYC,OACfqB,KAAKQ,OAASA,EACd,MAEF,QACE,OAAQK,GACN,KAAKnC,EAAYG,KACfmB,KAAKQ,OAAS9B,EAAYG,KAC1B,MAEF,KAAKH,EAAYE,MACfoB,KAAKQ,OAAS9B,EAAYE,MAC1B,MAEF,QACEoB,KAAKQ,OAAS9B,EAAYC,QAIlCqB,KAAKe,UAAUzB,EAAeE,IAAKQ,KAAKgB,IAAIb,KAAKH,OACjDA,KAAKe,UAAUzB,EAAeH,OAAQa,KAAKiB,MAAMd,KAAKH,OAGpDkB,YACF,MAAMC,EAAQnB,KAERoB,EAAiB,CACjBZ,aACF,OAAOW,EAAMX,QAEXA,WAAQa,GACVF,EAAMX,OAASa,IAInB,OAAO7C,EAAIQ,UAAUsC,SAASC,eAAe1B,MAAMqB,MAAOE,GAG5Db,oBACEP,KAAKwB,aAAa1C,EAAgBM,WAAY,IAGhD4B,MACEhB,KAAKyB,QAAQnC,EAAeH,OAAQa,KAAKQ,QAG3CS,MAAOI,GACLrB,KAAKQ,OAASa,EAGZb,aACF,OAAOR,KAAK0B,QAGVlB,WAAQa,GACV,GAAIrB,KAAK0B,UAAYL,EAArB,CAEA,OADArB,KAAK0B,QAAUL,EACPA,GACN,KAAK3C,EAAYC,OACfqB,KAAK2B,oBACL,MAEF,KAAKjD,EAAYG,KACfmB,KAAK4B,sBACL5B,KAAK6B,MAAQxC,EAAYR,KACzB,MAEF,KAAKH,EAAYE,MACfoB,KAAK4B,sBACL5B,KAAK6B,MAAQxC,EAAYT,MACzB,MAEF,QAEE,YADAoB,KAAKQ,OAAS9B,EAAYC,QAI9BqB,KAAKyB,QAAQnC,EAAeH,OAAQkC,GAChC7C,EAAIQ,UAAUyB,QAAQC,uBACxBC,aAAamB,QAAQ,SAAUT,GAEjCrB,KAAKwB,aAAa1C,EAAgBK,OAAQkC,IAGxCQ,YACF,OAAO7B,KAAK+B,OAGVF,UAAOR,GACT,GAAIrB,KAAK+B,SAAWV,EACpB,OAAQA,GACN,KAAKhC,EAAYT,MACjB,KAAKS,EAAYR,KACfmB,KAAK+B,OAASV,EACdrB,KAAKwB,aAAa1C,EAAgBC,MAAOsC,GACzCrB,KAAKyB,QAAQnC,EAAeP,MAAOsC,IAKzCM,oBACM3B,KAAKgC,cACThC,KAAKgC,aAAc,EACnBhC,KAAKiC,WAAaxD,OAAOyD,WAAW,gCACpClC,KAAKiC,WAAWE,iBAAiB,SAAUnC,KAAKC,UAChDD,KAAKE,UAGP0B,sBACO5B,KAAKgC,cACVhC,KAAKgC,aAAc,EACnBhC,KAAKiC,WAAWG,oBAAoB,SAAUpC,KAAKC,UACnDD,KAAKiC,WAAa,MAGpB/B,SACOF,KAAKgC,cACVhC,KAAK6B,MAAQ7B,KAAKiC,WAAWI,QAAUhD,EAAYR,KAAOQ,EAAYT,OAGxE0D,OAAQC,GACFA,EAAeC,QAAQ1D,EAAgBK,SAAW,IAAGa,KAAKQ,OAASR,KAAKc,aAAahC,EAAgBK,SACrGoD,EAAeC,QAAQ1D,EAAgBC,QAAU,IAAGiB,KAAK6B,MAAQ7B,KAAKc,aAAahC,EAAgBC,QAGzG0D,UACEzC,KAAK4B,uBCzJF,MAAMc,EAAiB,CAC5BvD,OAAQ,QAAQX,EAAIQ,UAAUC,GAAGC,KAAKyD,SAAS,kBAAkBnE,EAAIQ,UAAUC,GAAGC,KAAKyD,SAAS,YAChGC,aAAcpE,EAAIQ,UAAUC,GAAG0D,SAAS,gBACxCE,cAAe,eAAerE,EAAIQ,UAAUC,GAAG,qBCEjDT,EAAIgC,OAAS,CACXf,OAAQA,EACRf,YAAaA,EACbgE,eAAgBA,EAChBpD,eAAgBA,EAChBD,YAAaA,GCVfb,EAAIQ,UAAU8D,SAAStE,EAAIgC,OAAOkC,eAAevD,OAAQX,EAAIgC,OAAOf"}