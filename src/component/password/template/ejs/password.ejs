<%#
# paramètres password

* password.id (string, required) : id du mot de passe

* password.input (object, optional) : paramètres de l'input (voir composant input)

* password.checkbox (object, optional) : paramètres de la case à cocher afficher/masquer le mot de passe (voir composant checkbox)

* password.link (object, optional) paramètres du lien Mot de passe oublié
  ** password.link.href (string, required) : lien vers la page de récupération du mot de passe
  ** password.link.label (string, required) : libellé "Mot de passe oublié ?"
  ** password.link.attributes (object, optionnal) : Attributs supplémentaire sur le lien (ex: {target:'_blank'})

* password.attributes (object, optional) : attributs spécifiques à rajouter sur le mot de passe

* password.classes (array, optional) : classes spécifiques à rajouter sur le mot de passe

%>
<% eval(include('../../../../core/index.ejs')); %>
<% eval(include('../../../form/template/ejs/message/builder.js')); %>

<%
const password = locals.password || {button:{}, input:{}}
const passwordClasses = [...password.classes || [], prefix + '-password'];
const attributes = password.attributes || {};
const messages = password.messages || [];
const describedby = [];
attributes.id = password.id;

const input = password.input || {};
input.id = password.id + '-input';
input.name = input.name || 'password';
input.classes = [...input.classes || [], prefix + '-password__input'];
input.labelClasses = [...input.labelClasses || [], prefix + '-password__label'];
input.type = 'password';
input.icon = true; // ajoute le wrapper pour l'icone capslock
input.required = true;
input.attributes = input.attributes || {};

const builder = new MessageBuilder(password.id, false);
messages.forEach(message => builder.add(message.type, message.text));

if (messages.length > 0) input.attributes['aria-describedby'] = builder.ids.join(' ');

let checkbox = false;
if (password.checkbox) {
  checkbox = {...password.checkbox};
  checkbox.classes = checkbox.classes || [];
  checkbox.classes.push(prefix + '-password__checkbox');
  checkbox.label = checkbox.label || `${getText('show', 'password')}`;
  checkbox.id = checkbox.id || password.id + '-show';
  checkbox.size = 'sm';
  checkbox.attributes = checkbox.attributes || {};
  checkbox.attributes['aria-label'] = checkbox.attributes['aria-label'] || getText('show.long', 'password');
}

const link = password.link || {};
if (password.link) {
  link.label = link.label || getText('link.label', 'password');
  link.attributes = link.attributes || {};
  link.classes = link.classes || [];
  link.classes.push(prefix + '-link');
}
%>

<div <%- includeClasses(passwordClasses); %> <%- includeAttrs(attributes) %>>
  <%- include('../../../input/input-base/template/ejs/input.ejs', {input: input}); %>

  <%- include('../../../form/template/ejs/message/messages-group.ejs', {messagesGroup: builder.messagesGroup}); %>


  <% if (password.checkbox) { %>
    <div class="<%= prefix %>-password__checkbox <%= prefix %>-checkbox-group <%= prefix %>-checkbox-group--sm">
      <%- include('../../../checkbox/template/ejs/checkbox.ejs', {checkbox: checkbox}); %>
    </div>
    <% } %>

  <% if (password.link) { %>
    <p>
      <a href="<%= link.href %>" <%- includeClasses(link.classes); %> <%- includeAttrs(link.attributes); %>><%= link.label %></a>
    </p>
  <% } %>
</div>
