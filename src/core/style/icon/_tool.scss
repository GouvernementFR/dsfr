////
/// Core Tool : Icon
/// @group core
////

/// Return icon size from map
/// @param {String} $size ['md'] - Icon size from `$icon-size-map` (Default to 'md' = 16px)
///
/// @example scss - Set icon size to `SM` (12px)
///   .foo {
///     width: icon-size(sm);
///     height: icon-size(sm);
///   }
@function icon-size($size: md) {
  @return px-rem(map-get($icon-size-map, $size));
}

@mixin icon-size($size:md, $pseudo: null) {
  $selector: null;
  @if $pseudo == before or $pseudo == after {
    $selector: '&::#{$pseudo}';
  }
  @include nest($selector) {
    --icon-size: #{icon-size($size)};
  }
}

@mixin with-icon($size:md) {
  @include has-icon {
    @include before {
      @include icon-size($size);
      @content;
    }
  }
}

@mixin generate-icons($base, $type: dsfr) {
  $icons-settings: $icons-settings-dsfr;
  @if $type == remix {
    $icons-settings: $icons-settings-remix;
  }
  @each $icon, $setting in $icons-settings {
    #{ns(#{$base}-#{$icon})} {
      @include icon-content($icon, before, true);
    }
  }
}

@function is-remix-icon($icon) {
  @return index($icons-settings-dsfr, $icon) == null;
}

@mixin icon-content($icon, $pseudo: before, $important: false) {
  $remixIcon: is-remix-icon($icon);
  $icon-path: '#{$dist-path}icons/dsfr/';
  @if $remixIcon {
    $icon-path: '#{$dist-path}icons/remix/';
  }

  $url: url('#{$icon-path}#{$icon}.svg');
  $url: important($url, $important);

  @include _pseudo($pseudo, '') {
    -webkit-mask-image: $url;
    mask-image: $url;
  }
}

@mixin icon-style($pseudo: before) {
  @include _pseudo($pseudo) {
    flex: 0 0 auto;
    display: inline-block;
    vertical-align: middle;
    background-color: currentColor;
    width: var(--icon-size);
    height: var(--icon-size);
    -webkit-mask-size: 100% 100%;
    mask-size: 100% 100%;
  }
}

@mixin icon($icon: null, $size: md, $pseudo: before, $init: true) {
  @if $init {
    @include icon-style($pseudo);
  }

  @if $icon != null {
    @include icon-content($icon, $pseudo);
  }

  @if $size != null {
    @include icon-size($size);
  }

  @include _pseudo($pseudo) {
    @content;
  }
}
