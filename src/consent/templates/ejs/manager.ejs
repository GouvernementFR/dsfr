<%#
# paramètres du gestionnaire de consentement

* finalities (array, required) : Tableau de finalités
* |- title (string, recommanded): titre de la finalité
* |- desc (string, optionnal): texte de description additionnel
* |- radios (array, optionnal): paramètres de boutons radios (par défaut 2 éléments accepter/refuser)
* |_ services (array, optionnal) : Tableau de sous-finalités
*   |- title (string, recommanded): titre de la finalité
*   |- desc (string, optionnal): texte de description additionnel

* body (string, optionnal) : Texte explicatif, contenu textuel ou html

* buttons (array, required): paramètres spécifique de chaque bouton du groupe

%>

<% let finalities = locals.finalities || {}; %>
<% let buttons = locals.buttons || [{label: 'Confirmer mes choix'}]; %>

<div class="<%= prefix %>-consent-manager">

  <% for (finality = 0; finality < finalities.length; finality++) { %>
  <div class="<%= prefix %>-consent-service <%- (finality === 0) ? prefix + '-consent-manager__header' : ''; %>">
    <div class="<%= prefix %>-consent-service__container">
      <% if (finalities[finality].title) { %>
        <h6 class="<%= prefix %>-consent-service__title"><%- finalities[finality].title %></h6>
      <% } %>
      <div class="<%= prefix %>-consent-service__radios <%= prefix %>-fieldset--inline">
        <%- include('../../../radios/templates/ejs/radio-group', {...finalities[finality].radios[0]} ) %>
        <%- include('../../../radios/templates/ejs/radio-group', {...finalities[finality].radios[1]} ) %>
      </div>
      <% if (finalities[finality].desc) { %>
        <div class="<%= prefix %>-consent-service__desc"><%- finalities[finality].desc %></div>
      <% } %>
    </div>

    <% if (finalities[finality].services) { %>
      <div class="<%= prefix %>-consent-service__collapse">
        <button class="<%= prefix %>-consent-service__collapse-btn" aria-expanded="false" aria-controls="<%= finalities[finality].id  %>-collapse"> Voir plus de détails</button>
      </div>

      <div class="<%= prefix %>-consent-services <%= prefix %>-collapse" id="<%= finalities[finality].id  %>-collapse">
        <!-- sous finalités -->
        <% for (service = 0; service < finalities[finality].services.length; service++) { %>
        <div class="<%= prefix %>-consent-service">
          <div class="<%= prefix %>-consent-service__container">
            <% if (finalities[finality].services[service].title) { %>
              <h6 class="<%= prefix %>-consent-service__title"><%- finalities[finality].services[service].title %></h6>
            <% } %>
            <div class="<%= prefix %>-consent-service__radios <%= prefix %>-fieldset--inline">
              <%- include('../../../radios/templates/ejs/radio-group', {...finalities[finality].services[service].radios[0]} ) %>
              <%- include('../../../radios/templates/ejs/radio-group', {...finalities[finality].services[service].radios[1]} ) %>
            </div>
            <% if (finalities[finality].services[service].desc) { %>
              <div class="<%= prefix %>-consent-service__desc"><%- finalities[finality].services[service].desc %></div>
            <% } %>
          </div>
        </div>
        <% } %>

      </div>
    <% } %>
  </div>
  <% } %>

  <%- include('../../../buttons/templates/ejs/buttons-group.ejs', {classes: [prefix + '-consent-manager__buttons'], size: 'md', inline: 'sm', align:'right', buttons: buttons}); %>

</div>